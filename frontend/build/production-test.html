<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba fetchPoliticasPago - Modo Producci√≥n</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        .status-panel {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #34495e;
            margin-top: 0;
        }
        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #2980b9;
        }
        button:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
        }
        .success {
            color: #27ae60;
            font-weight: bold;
        }
        .error {
            color: #e74c3c;
            font-weight: bold;
        }
        .warning {
            color: #f39c12;
            font-weight: bold;
        }
        .info {
            color: #3498db;
            font-weight: bold;
        }
        #output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 20px;
        }
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .result-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #f9f9f9;
        }
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Prueba fetchPoliticasPago - Modo Producci√≥n</h1>
        
        <div class="status-panel">
            <h3>üìä Estado del Sistema</h3>
            <div class="metric">
                <span>DEBUG_MODE:</span>
                <span id="debugModeStatus">Verificando...</span>
            </div>
            <div class="metric">
                <span>Funci√≥n disponible:</span>
                <span id="functionStatus">Verificando...</span>
            </div>
            <div class="metric">
                <span>API Base URL:</span>
                <span id="apiUrlStatus">Verificando...</span>
            </div>
        </div>

        <div class="test-section">
            <h3>üöÄ Pruebas de Funcionamiento</h3>
            <button id="testBasicCall" onclick="testBasicFunctionCall()">
                Prueba B√°sica de Llamada
            </button>
            <button id="testApiCall" onclick="testApiCall()">
                Probar Llamada a API
            </button>
            <button id="testErrorHandling" onclick="testErrorHandling()">
                Probar Manejo de Errores
            </button>
            <button id="clearOutput" onclick="clearOutput()">
                Limpiar Output
            </button>
        </div>

        <div class="test-section">
            <h3>üìà Resultados de Pruebas</h3>
            <div class="results-grid">
                <div class="result-card">
                    <h4>M√©tricas de Rendimiento</h4>
                    <div class="metric">
                        <span>Tiempo de respuesta:</span>
                        <span id="responseTime">-</span>
                    </div>
                    <div class="metric">
                        <span>Estado de conexi√≥n:</span>
                        <span id="connectionStatus">-</span>
                    </div>
                </div>
                <div class="result-card">
                    <h4>Datos Obtenidos</h4>
                    <div class="metric">
                        <span>Pol√≠ticas encontradas:</span>
                        <span id="politicasCount">-</span>
                    </div>
                    <div class="metric">
                        <span>Fuente de datos:</span>
                        <span id="dataSource">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div id="output"></div>
    </div>

    <script type="module">
        // Importar la funci√≥n desde el servicio
        import { fetchPoliticasPago, DEBUG_MODE, API_URL } from '../src/services/reservationServices.js';
        
        let outputElement;
        
        function log(message, type = 'info') {
            if (!outputElement) {
                outputElement = document.getElementById('output');
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'success' ? '‚úÖ' : 
                          type === 'error' ? '‚ùå' : 
                          type === 'warning' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            
            outputElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            outputElement.scrollTop = outputElement.scrollHeight;
        }
        
        // Verificar estado inicial
        window.addEventListener('DOMContentLoaded', function() {
            document.getElementById('debugModeStatus').innerHTML = 
                DEBUG_MODE ? '<span class="warning">TRUE (Desarrollo)</span>' : 
                '<span class="success">FALSE (Producci√≥n)</span>';
            
            document.getElementById('functionStatus').innerHTML = 
                typeof fetchPoliticasPago === 'function' ? 
                '<span class="success">Disponible</span>' : 
                '<span class="error">No disponible</span>';
            
            document.getElementById('apiUrlStatus').innerHTML = 
                API_URL ? `<span class="success">${API_URL}</span>` : 
                '<span class="warning">No configurada</span>';
                
            log('üöÄ Sistema inicializado');
            log(`DEBUG_MODE: ${DEBUG_MODE}`);
            log(`API_URL: ${API_URL || 'No configurada'}`);
        });
        
        // Funci√≥n b√°sica de prueba
        window.testBasicFunctionCall = async function() {
            log('--- Iniciando prueba b√°sica ---');
            
            try {
                log('Verificando funci√≥n fetchPoliticasPago...');
                
                if (typeof fetchPoliticasPago !== 'function') {
                    throw new Error('fetchPoliticasPago no es una funci√≥n');
                }
                
                log('‚úÖ Funci√≥n disponible', 'success');
                log('üîß Configuraci√≥n verificada', 'success');
                
                // Actualizar m√©tricas
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="success">Funci√≥n OK</span>';
                
            } catch (error) {
                log(`Error en prueba b√°sica: ${error.message}`, 'error');
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="error">Error</span>';
            }
        };
        
        // Prueba de llamada a API
        window.testApiCall = async function() {
            log('--- Iniciando prueba de API ---');
            
            try {
                const startTime = Date.now();
                log('‚è≥ Realizando llamada a fetchPoliticasPago()...');
                
                const politicas = await fetchPoliticasPago();
                const endTime = Date.now();
                const duration = endTime - startTime;
                
                log(`‚úÖ Llamada exitosa en ${duration}ms`, 'success');
                log(`üìä Pol√≠ticas obtenidas: ${politicas.length}`, 'success');
                
                // Actualizar m√©tricas
                document.getElementById('responseTime').innerHTML = 
                    `<span class="success">${duration}ms</span>`;
                document.getElementById('politicasCount').innerHTML = 
                    `<span class="success">${politicas.length}</span>`;
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="success">Conectado</span>';
                document.getElementById('dataSource').innerHTML = 
                    DEBUG_MODE ? '<span class="warning">Testing Data</span>' : 
                    '<span class="success">API Backend</span>';
                
                // Mostrar datos de muestra
                if (politicas.length > 0) {
                    log('üìã Muestra de pol√≠tica:');
                    const sample = politicas[0];
                    log(`   ID: ${sample.id}`);
                    log(`   T√≠tulo: ${sample.titulo}`);
                    log(`   Activo: ${sample.activo}`);
                    
                    // Verificar que solo hay pol√≠ticas activas
                    const activePolicies = politicas.filter(p => p.activo === true);
                    if (activePolicies.length === politicas.length) {
                        log('‚úÖ Todas las pol√≠ticas est√°n activas', 'success');
                    } else {
                        log(`‚ö†Ô∏è ${politicas.length - activePolicies.length} pol√≠ticas inactivas encontradas`, 'warning');
                    }
                }
                
            } catch (error) {
                const endTime = Date.now();
                log(`‚ùå Error en llamada: ${error.message}`, 'error');
                
                // Actualizar m√©tricas de error
                document.getElementById('connectionStatus').innerHTML = 
                    '<span class="error">Error de conexi√≥n</span>';
                document.getElementById('dataSource').innerHTML = 
                    '<span class="error">Sin datos</span>';
                
                // Analizar tipo de error
                if (error.message.includes('Network Error') || 
                    error.message.includes('fetch')) {
                    log('‚ÑπÔ∏è Error de red - Backend posiblemente no disponible', 'warning');
                } else if (error.message.includes('CORS')) {
                    log('‚ÑπÔ∏è Error CORS - Configuraci√≥n de servidor requerida', 'warning');
                } else {
                    log(`‚ÑπÔ∏è Tipo de error: ${error.constructor.name}`, 'warning');
                }
            }
        };
        
        // Prueba de manejo de errores
        window.testErrorHandling = async function() {
            log('--- Iniciando prueba de manejo de errores ---');
            
            try {
                log('üîç Verificando comportamiento con API no disponible...');
                
                // En modo producci√≥n, debe fallar sin usar datos de testing
                if (!DEBUG_MODE) {
                    log('‚úÖ Modo producci√≥n: errores se propagan correctamente', 'success');
                    log('‚ÑπÔ∏è En producci√≥n, NO se usan datos de testing como fallback');
                } else {
                    log('‚ö†Ô∏è Modo desarrollo: se usar√°n datos de testing en caso de error', 'warning');
                }
                
            } catch (error) {
                log(`Error inesperado en prueba: ${error.message}`, 'error');
            }
        };
        
        // Limpiar output
        window.clearOutput = function() {
            document.getElementById('output').textContent = '';
            log('üßπ Output limpiado');
        };
        
        // Hacer las funciones globales
        window.fetchPoliticasPago = fetchPoliticasPago;
        window.DEBUG_MODE = DEBUG_MODE;
        window.API_URL = API_URL;
        
        log('üåê P√°gina cargada - Funciones disponibles globalmente');
        log('üìã Funciones disponibles en consola:');
        log('   - fetchPoliticasPago() - Llamar directamente a la funci√≥n');
        log('   - testBasicFunctionCall() - Prueba b√°sica');
        log('   - testApiCall() - Prueba de API');
        log('   - testErrorHandling() - Prueba de errores');
    </script>
</body>
</html>
